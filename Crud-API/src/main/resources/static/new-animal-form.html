<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New Animal - Nature Valley Farm</title>
    <link rel="stylesheet" href="./Animal-Form.css">
</head>
<body>
    <nav class="navigation">
        <a href="index.html">Home</a>
        <a href="details.html">Details</a>
        <a href="about.html">About Us</a>
        <a href="new-animal-form.html">New Animal Form</a>
    </nav>

    <h1 style="text-align:center;">Add a New Animal!</h1>

    <form class="animal-form" id="animalForm">
        <label for="name">Name</label>
        <input type="text" id="name" placeholder="Enter animal name" required>

        <label for="breed">Animal Breed</label>
        <input type="text" id="breed" placeholder="Enter animal breed" required>

        <label for="weight">Weight (kg)</label>
        <input type="number" id="weight" placeholder="Enter weight in kg" step="0.1" min="0" required>

        <label for="description">Description</label>
        <textarea id="description" placeholder="Describe the animal" rows="4" required></textarea>

        <button type="submit">Add Animal</button>
    </form>

    <div id="formMessage" style="text-align: center; margin-top: 20px;"></div>

    <!-- Include the API JavaScript file -->
    <script src="./animals-api.js"></script>
    <script>
        document.getElementById('animalForm').addEventListener('submit', async function(e) {
            e.preventDefault(); // Prevent form from submitting normally
            
            const formMessage = document.getElementById('formMessage');
            const submitButton = e.target.querySelector('button[type="submit"]');
            
            // Get form data
            const animalData = {
                name: document.getElementById('name').value.trim(),
                breed: document.getElementById('breed').value.trim(),
                weight: parseFloat(document.getElementById('weight').value),
                description: document.getElementById('description').value.trim()
            };
            
            // Validate required fields
            if (!animalData.name || !animalData.breed || !animalData.weight || !animalData.description) {
                formMessage.innerHTML = '<p style="color: red;">Please fill in all fields.</p>';
                return;
            }
            
            if (animalData.weight <= 0) {
                formMessage.innerHTML = '<p style="color: red;">Weight must be greater than 0.</p>';
                return;
            }
            
            try {
                // Disable submit button and show loading
                submitButton.disabled = true;
                submitButton.textContent = 'Adding Animal...';
                formMessage.innerHTML = '<p style="color: blue;">Creating new animal...</p>';
                
                // Submit to API
                const newAnimal = await createAnimal(animalData);
                
                // Success message
                formMessage.innerHTML = `
                    <p style="color: green;">
                        <strong>Animal "${newAnimal.name}" added successfully!</strong><br>
                        Animal ID: ${newAnimal.animalId}
                    </p>
                    <p><a href="index.html">View all animals</a> | <a href="details.html?id=${newAnimal.animalId}">View ${newAnimal.name}'s details</a></p>
                `;
                
                // Clear form
                document.getElementById('animalForm').reset();
                
            } catch (error) {
                console.error('Error creating animal:', error);
                formMessage.innerHTML = `<p style="color: red;">Error adding animal: ${error.message}</p>`;
            } finally {
                // Re-enable submit button
                submitButton.disabled = false;
                submitButton.textContent = 'Add Animal';
            }
        });
        
        // Clear message when user starts typing
        document.querySelectorAll('#animalForm input, #animalForm textarea').forEach(input => {
            input.addEventListener('input', function() {
                const formMessage = document.getElementById('formMessage');
                if (formMessage.innerHTML.includes('Please fill in all fields') || 
                    formMessage.innerHTML.includes('Weight must be greater than 0')) {
                    formMessage.innerHTML = '';
                }
            });
        });
    </script>

</body>
</html>